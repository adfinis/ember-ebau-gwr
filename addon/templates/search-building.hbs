{{#if @model}}
  <BackRoute
    @backRoute="project.linked-buildings"
    @backModel={{@model}}
    @backText={{t "ember-gwr.building.backToProject"}}
  />
{{else}}
  <BackRoute
    @backRoute="global-landing-page"
    @backText={{t "ember-gwr.globalLandingPage.backToGlobal"}}
  />
{{/if}}

<h1>
  {{t "ember-gwr.searchBuilding.heading"}}
</h1>

<Search::Filters
  @model={{this.searchModel}}
  @validations={{this.BuildingSearchValidations}}
  @search={{this.search}}
  @extendedSearch={{true}}
  as |FilterInput Form ErrorSelect ExtendedSearchToggle|
>
  <div class="uk-flex uk-flex-wrap uk-flex-between">
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <FilterInput
          @label={{t "ember-gwr.building.EGID"}}
          @name="EGID"
          @translationBase="ember-gwr.building"
        />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <FilterInput
          @label={{t "ember-gwr.building.dateOfConstruction.periodOfConstruction"}}
          @type="select"
          @name="periodOfConstruction"
          @optionLabelPath="label"
          @optionValuePath="value"
          @optionTargetPath="value"
          @prompt={{t "ember-gwr.building.dateOfConstruction.periodOfConstructionPlaceholder"}}
          @options={{this.periodOfConstructionOptions}}
        />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <ErrorSelect />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <FilterInput
          @name="descriptionLong"
          @label={{t "ember-gwr.building.street.description.descriptionLong"}}
        />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <FilterInput
          @name="buildingEntranceNo"
          @label={{t "ember-gwr.building.buildingEntranceNo"}}
        />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <FilterInput
          @name="nameLong"
          @label={{t "ember-gwr.building.locality.name.nameLong"}}
        />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <FilterInput
          @name="realestateIdentification.number"
          @label={{t "ember-gwr.building.realestateIdentification.number"}}
        />
      </div>
    </div>
    <div class="uk-width-1-3@m uk-width-1">
      <div class="uk-margin-small-right">
        <ExtendedSearchToggle class="uk-margin-top uk-width-1-1"/>
      </div>
    </div>
  </div>
</Search::Filters>

{{#if this.search.last}}
  <Search::ResultTable
    @results={{this.searchResults}}
    @loading={{this.search.isRunning}}
    as |Row|
  >
    <Search::ResultTable::Head as |Header|>
      <Header class="uk-table-shrink" @label={{t "ember-gwr.building.EGID"}} />
      <Header
        @label={{t "ember-gwr.searchBuilding.entrances"}}
        class="uk-table-expand"
      />
      <Header
        @label={{t
          "ember-gwr.building.dateOfConstruction.periodOfConstruction"
        }}
      />
    </Search::ResultTable::Head>
    <Row as |Field|>
      <Field @attr="EGID" as |value|>
        <button
          class="uk-button uk-button-link"
          type="button"
          {{on "click" (fn this.setActiveBuilding value)}}
        >
          {{value}}
        </button>
      </Field>
      <Field @attr="fullAddressTexts" as |value|>
        <ul class="uk-list">
          {{#each value as |entrance|}}
            <li>
              {{entrance}}
            </li>
          {{/each}}
        </ul>
      </Field>
      <Field @attr="dateOfConstruction" as |value|>
        {{#if value.periodOfConstruction}}
          {{t
            (concat
              "ember-gwr.building.dateOfConstruction.periodOfConstructionOptions."
              value.periodOfConstruction
            )
          }}
        {{else if value.year}}
          {{value.year}}
        {{else}}
          -
        {{/if}}
      </Field>
    </Row>
  </Search::ResultTable>

  <LinkBuildingModal
    @visible={{this.activeBuilding}}
    @close={{fn this.setActiveBuilding null}}
    @linkAction={{perform this.linkBuilding this.activeBuilding}}
    @errors={{this.errors}}
    @isLoading={{this.linkBuilding.isRunning}}
  />
{{/if}}
